//Internet Of Thing Blynk with ESP 32 W ROOM Multiple Sensor & Control Maintenance Smart_phone
#define BLYNK_PRINT Serial
#include <BlynkSimpleEsp32.h>
#include <WiFi.h>
#include <WiFiClient.h>
#include <DHT.h>
#define DHTPIN 4
#define DHTTYPE DHT11
DHT dht(DHTPIN,DHTTYPE);
#define sensor 36
#define pinAout 39
int sv;
int selectMode;
char auth[] = "Your auth";
char ssid[] = "ssid";
char pass[] = "Password";
#define lampu 23
#define kipas 22
#define lmpkmr 21
#define lmplr 19
#define lmplr1 18
#define snd 5
BlynkTimer waktu;
void setup() {
  // put your setup code here, to run once:
Blynk.begin(auth,ssid,pass);
dht.begin();
Serial.begin(9600);
pinMode(lampu, OUTPUT);
pinMode(kipas, OUTPUT);
pinMode(lmpkmr, OUTPUT);
pinMode(lmplr, OUTPUT);
pinMode(lmplr1, OUTPUT);
pinMode(snd, OUTPUT);
digitalWrite(kipas, HIGH);
digitalWrite(lampu, HIGH);
waktu.setInterval(1000L, function);
}
void function()
{
  if (selectMode == 1)
  {
  sv = analogRead(sensor);
  int asap = analogRead(pinAout);
  int LPG = asap / 10;
  int carbon = asap * 2;
  int t = dht.readTemperature();
  int h = dht.readHumidity();
  Serial.println(sv);
  Serial.println(asap);
  Serial.println(t);
  Serial.println(h);
  Blynk.virtualWrite(V5, t);
  Blynk.virtualWrite(V6, h);
  Blynk.virtualWrite(V7, sv);
  Blynk.virtualWrite(V8, asap);
  Blynk.virtualWrite(V9, LPG);
  Blynk.virtualWrite(V10, carbon);
  if (asap <= 1200)
    {
      digitalWrite(kipas, HIGH);
      Blynk.virtualWrite(V11, "Udara Normal");
      digitalWrite(snd, LOW);
    }
    else if (asap >=1201)
    {
      digitalWrite(kipas, LOW);
      Blynk.virtualWrite(V11, "Udara Berasap");
      digitalWrite(snd, HIGH);
      delay(800);
      digitalWrite(snd, LOW);
      delay(200);
    }
    if (sv <=37)
    {
      digitalWrite(lmpkmr, LOW);
      digitalWrite(lmplr, LOW);
      digitalWrite(lmplr1, LOW);
    }
    else if(sv >= 38)
    {
      digitalWrite(lmpkmr, HIGH);
      digitalWrite(lmplr, HIGH);
      digitalWrite(lmplr1, HIGH);
    }
   }
    else
   {
      sv = analogRead(sensor);
      int asap = analogRead(pinAout);
      int LPG = asap / 10;
      int carbon = asap * 2;
      int t = dht.readTemperature();
      int h = dht.readHumidity();
      Serial.println(sv);
      Serial.println(asap);
      Serial.println(t);
      Serial.println(h);
      Blynk.virtualWrite(V5, t);
      Blynk.virtualWrite(V6, h);
      Blynk.virtualWrite(V7, sv);
      Blynk.virtualWrite(V8, asap);
      Blynk.virtualWrite(V9, LPG);
      Blynk.virtualWrite(V10, carbon);
      digitalWrite(snd, LOW);
      if (asap <= 1200)
      {
        Blynk.virtualWrite(V11, "Udara Normal");
      }
      else if (asap >=1201)
      {
        Blynk.virtualWrite(V11, "Udara Berasap");
      }
  }
}
BLYNK_WRITE(V12)
{
  selectMode = param.asInt();
  function;
}
BLYNK_WRITE(V1)
{
  if(param.asInt()==1)
  {
    digitalWrite(kipas, LOW);
  }
  else if (param.asInt()==0)
  {
    digitalWrite(kipas, HIGH);
  }
}
BLYNK_WRITE(V2)
{
  if(param.asInt()==1)
  {
    digitalWrite(lmpkmr, HIGH);
  }
  else if (param.asInt()==0)
  {
    digitalWrite(lmpkmr, LOW);
  }
}
BLYNK_WRITE(V3)
{
  if(param.asInt()==1)
  {
    digitalWrite(lmplr, HIGH);
    digitalWrite(lmplr1, HIGH);
  }
  else if (param.asInt()==0)
  {
    digitalWrite(lmplr, LOW);
    digitalWrite(lmplr1, LOW);
  }
}
BLYNK_WRITE(V4)
{
  if(param.asInt()==1)
  {
    digitalWrite(lampu, LOW);
  }
  else if (param.asInt()==0)
  {
    digitalWrite(lampu, HIGH);
  }
}

void loop() {
Blynk.run();
waktu.run();
}
